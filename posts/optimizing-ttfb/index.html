<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Faster Page Loads - Reducing the Time to First Byte (TTFB) by 50%" /><meta property="og:locale" content="en" /><meta name="description" content="Oct, 2023: Engineering at Rewaa decided to improve the page load performance of its Platform Webapp. Of the many performance metrics available to us, we prioritized improving Time to First Byte (TTFB)." /><meta property="og:description" content="Oct, 2023: Engineering at Rewaa decided to improve the page load performance of its Platform Webapp. Of the many performance metrics available to us, we prioritized improving Time to First Byte (TTFB)." /><link rel="canonical" href="https://mohuk.dev/posts/optimizing-ttfb/" /><meta property="og:url" content="https://mohuk.dev/posts/optimizing-ttfb/" /><meta property="og:site_name" content="Muhammad Umair Khan" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-02-08T11:59:17+05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Faster Page Loads - Reducing the Time to First Byte (TTFB) by 50%" /><meta name="twitter:site" content="@mohukh" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-02-12T13:21:29+05:00","datePublished":"2024-02-08T11:59:17+05:00","description":"Oct, 2023: Engineering at Rewaa decided to improve the page load performance of its Platform Webapp. Of the many performance metrics available to us, we prioritized improving Time to First Byte (TTFB).","headline":"Faster Page Loads - Reducing the Time to First Byte (TTFB) by 50%","mainEntityOfPage":{"@type":"WebPage","@id":"https://mohuk.dev/posts/optimizing-ttfb/"},"url":"https://mohuk.dev/posts/optimizing-ttfb/"}</script><title>Faster Page Loads - Reducing the Time to First Byte (TTFB) by 50% | Muhammad Umair Khan</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Muhammad Umair Khan"><meta name="application-name" content="Muhammad Umair Khan"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Muhammad Umair Khan</a></div><div class="site-subtitle font-italic">Engineer, Mentor, Foo, Bar</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/mohuk" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/mohukh" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['mohammad.umair.k','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://linkedin.com/in/mohuk" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Faster Page Loads - Reducing the Time to First Byte (TTFB) by 50%</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Faster Page Loads - Reducing the Time to First Byte (TTFB) by 50%</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1707375557" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Feb 8, 2024 </em> </span> <span> Updated <em class="" data-ts="1707726089" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Feb 12, 2024 </em> </span><div class="d-flex justify-content-between"> <span> By <em> Muhammad Umair Khan </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1168 words"> <em>6 min</em> read</span></div></div></div><div class="post-content"><p>Oct, 2023: Engineering at Rewaa decided to improve the page load performance of its Platform Webapp. Of the many performance metrics available to us, we prioritized improving <em>Time to First Byte (TTFB)</em>.</p><blockquote><p><em>TTFB measures the duration from the user or client making an HTTP request to the first byte of the page being received by the client’s browser.</em> – <a href="https://en.wikipedia.org/wiki/Time_to_first_byte#">Wikipedia</a></p></blockquote><h2 id="why-ttfb"><span class="mr-2">Why TTFB?</span><a href="#why-ttfb" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>One might argue, why optimize TTFB ahead of user centric metrics like <a href="https://web.dev/articles/lcp">LCP</a> and <a href="https://web.dev/articles/fcp">FCP</a>? To answer this, we have to understand the significance of optimizing TTFB when serving Single Page Applications (SPAs).</p><p>A Single Page Application (SPA) has to deliver the <code class="language-plaintext highlighter-rouge">index.html</code> file to the browser first. The <code class="language-plaintext highlighter-rouge">index.html</code> file then requests for more files (css,js,fonts) which execute and render meaningful content for the user. The sooner the <code class="language-plaintext highlighter-rouge">index.html</code> is delivered to the browser, the quicker user centric content can start rendering. This is why TTFB is crucial when serving SPAs.</p><p><strong>With the case established for optimizing TTFB, we decided to punch above our waist and set our target to reduce TTFB to less than <code class="language-plaintext highlighter-rouge">500ms</code>.</strong></p><h2 id="what-is-a-good-ttfb-score"><span class="mr-2">What is a good TTFB score?</span><a href="#what-is-a-good-ttfb-score" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The quicker, the better. However it is understood that anything below <code class="language-plaintext highlighter-rouge">800ms</code> is good.</p><p><img data-src="/assets/img/2024-02-08-img-01.png" alt="TTFB Score" data-proofer-ignore></p><h2 id="measuring-ttfb"><span class="mr-2">Measuring TTFB</span><a href="#measuring-ttfb" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><em>“You cannot improve what you don’t measure”</em>.</p><p>You can measure TTFB by:</p><ul><li>Network Tab of the browser<li>Performance analysis through Lighthouse (or a similar tool)</ul><p>It is important to understand that TTFB depends on many factors resulting in different measures for each user. Measuring a 75th percentile of Average TTFB across all users was more meaningful to track as compared to single user values provided by the options mentioned above. I was able to setup the graph using <a href="https://docs.datadoghq.com/real_user_monitoring/">Real User Monitoring (RUM)</a> on Datadog.</p><p><img data-src="/assets/img/2024-02-08-img-03.png" alt="Dashboard - TTFB" data-proofer-ignore></p><p>The numbers proved we were not <code class="language-plaintext highlighter-rouge">Poor</code> but not <code class="language-plaintext highlighter-rouge">Good</code> either.</p><blockquote><p>… we decided to punch above our waist and set our target to reduce TTFB to less than <code class="language-plaintext highlighter-rouge">500ms</code>.</p></blockquote><h2 id="current-content-delivery-setup"><span class="mr-2">Current Content Delivery Setup</span><a href="#current-content-delivery-setup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Our Platform Webapp is a Single Page Application built with Angular, being served from Mumbai through AWS CloudFront. SPAs require a specific kind of routing where each registered route within the application should return the <code class="language-plaintext highlighter-rouge">index.html</code> file. Our current setup on CloudFront was doing that but in a strange way. Each registered route resulted in a <code class="language-plaintext highlighter-rouge">Http 404</code>, which we intercepted and returned the <code class="language-plaintext highlighter-rouge">index.html</code> file along with it.</p><p><img data-src="/assets/img/2024-02-08-img-04.png" alt="Static Content Delivery 1.0" data-proofer-ignore></p><h2 id="limitations-of-the-current-content-delivery-setup"><span class="mr-2">Limitations of the current Content Delivery setup</span><a href="#limitations-of-the-current-content-delivery-setup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I realized there are several problems with our setup:</p><ul><li><p><strong>All initial page loads were 404s with <code class="language-plaintext highlighter-rouge">index.html</code></strong>: It works but it has its side effects which maybe unknown. One such example is, running “Lighthouse” page load performance refuses to compute results because <code class="language-plaintext highlighter-rouge">index.html</code> has a <code class="language-plaintext highlighter-rouge">404 - Not Found</code> status.</p><li><p><strong>All requests were resulting in a cache miss</strong>: Each cache miss resulted in content being delivered directly from the origin. No advantage was being taken from the intermediate caches. Mumbai (our primary region) was serving the entire world irrespective of distance.</p></ul><h2 id="solutions"><span class="mr-2">Solutions</span><a href="#solutions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The lifecycle events illustrated below forms the foundations of all the performance gains, so pay close attention to it.</p><p><img data-src="/assets/img/2024-02-08-img-06.png" alt="Lambda@Edge - AWS Docs" data-proofer-ignore></p><h3 id="routing-fix"><span class="mr-2">Routing fix</span><a href="#routing-fix" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The first step was to get rid of the 404s by returning the <code class="language-plaintext highlighter-rouge">index.html</code> file on all routes without an extension (png,css,woff). <code class="language-plaintext highlighter-rouge">Lambda@Edge</code>, which is a specific kind of lambda function has the ability to execute code before the request reaches CloudFront.</p><p>The ability to intercept a request before it reaches CloudFront Cache i.e. <code class="language-plaintext highlighter-rouge">Viewer Request</code> is all I needed. In the following few lines, I was able to rewrite the incoming requests to <code class="language-plaintext highlighter-rouge">index.html</code>.</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">context</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">request</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">Records</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">cf</span><span class="p">;</span>

  <span class="kd">const</span> <span class="nx">re</span> <span class="o">=</span> <span class="sr">/</span><span class="se">(?:\.([^</span><span class="sr">.</span><span class="se">]</span><span class="sr">+</span><span class="se">))?</span><span class="sr">$/</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">re</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">uri</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">newuri</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">uri</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/.*/</span><span class="p">,</span> <span class="dl">'</span><span class="s1">/index.html</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">request</span><span class="p">.</span><span class="nx">uri</span> <span class="o">=</span> <span class="nx">newuri</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">request</span><span class="p">);</span>
<span class="p">};</span>
</pre></table></code></div></div><p>With <code class="language-plaintext highlighter-rouge">Lambda@Edge</code> setup to execute at <code class="language-plaintext highlighter-rouge">Viewer Request</code>, I just removed the <code class="language-plaintext highlighter-rouge">Custom error response</code> from <code class="language-plaintext highlighter-rouge">Error pages</code> to rid the setup for <code class="language-plaintext highlighter-rouge">404</code> intercepts.</p><h3 id="caching-fix"><span class="mr-2">Caching fix</span><a href="#caching-fix" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The next target was to minimize the <code class="language-plaintext highlighter-rouge">cache miss</code> illustrated in the diagrams above. To cache content, the CDN looks for the <code class="language-plaintext highlighter-rouge">Cache-Control</code> headers. The <code class="language-plaintext highlighter-rouge">Cache-Control</code> header in our app was set to <code class="language-plaintext highlighter-rouge">no-cache, no-store, must-revalidate</code>. Let’s break this down:</p><ul><li><code class="language-plaintext highlighter-rouge">no-cache</code>: This does not mean “don’t cache”. Cache will always revalidate content from the source before serving.<li><code class="language-plaintext highlighter-rouge">no-store</code>: No content would be stored in <strong>any</strong> cache.<li><code class="language-plaintext highlighter-rouge">must-revalidate</code>: Response will be reused while fresh. Response will be validated once stale.</ul><p>The <code class="language-plaintext highlighter-rouge">no-store</code> not allowing anything to be stored made the <code class="language-plaintext highlighter-rouge">no-cache</code> and <code class="language-plaintext highlighter-rouge">must-revalidate</code> directives practically useless. Worth mentioning that <code class="language-plaintext highlighter-rouge">must-revalidate</code> always should be used with <code class="language-plaintext highlighter-rouge">max-age</code> to help the cache identify fresh content. In short, the configuration was completely broken.</p><p>By setting <code class="language-plaintext highlighter-rouge">Cache-Control</code> header to <code class="language-plaintext highlighter-rouge">must-revalidate max-age=604800</code>, CloudFront served the cached responses until a reasonable amount of time (7 days) has passed or there is new content available. Setting the correct cache headers also enabled <code class="language-plaintext highlighter-rouge">ETag</code> on each request resulting in a <code class="language-plaintext highlighter-rouge">Http 304 Not Modified</code> if the content did not change. For new releases, we programmatically invalidated all CloudFront caches to ensure the new release always results in fresh content for our users.</p><h2 id="icing-on-the-cake---cloudfront-functions"><span class="mr-2">Icing on the cake - CloudFront Functions</span><a href="#icing-on-the-cake---cloudfront-functions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>While monitoring the logs I noticed that all content is being served from Frankfurt. With most of our customer base in Saudi Arabia, not serving content from Mumbai (our deployment region) was definitely a win. I wondered if there were still a few more millisecond I could reduce by serving from an <code class="language-plaintext highlighter-rouge">Edge Location</code> instead of a <code class="language-plaintext highlighter-rouge">Regional Edge Cache</code>.</p><blockquote><p><strong>tl;dr</strong> <code class="language-plaintext highlighter-rouge">Edge Location</code> serves content with reduced latency because it is nearer to the users as compared to the <code class="language-plaintext highlighter-rouge">Regional Edge Cache</code>.</p></blockquote><p>The reason why all our content was being served from Frankfurt is because <code class="language-plaintext highlighter-rouge">Lambda@Edge</code> executes only on the Regional Edge Cache. Since our routing logic was simple, moving it to <code class="language-plaintext highlighter-rouge">CloudFront Functions</code> (Event source: Viewer Request) was the better choice. A clear reduction of approx. <code class="language-plaintext highlighter-rouge">100ms</code> was noticed by moving from <code class="language-plaintext highlighter-rouge">Lambda@Edge</code> to <code class="language-plaintext highlighter-rouge">CloudFront Functions</code> You can find all the difference between Lambda@Edge and <code class="language-plaintext highlighter-rouge">CloudFront Functions</code> at <a href="https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/edge-functions-choosing.html">this link</a>.</p><p><img data-src="/assets/img/2024-02-08-img-09.png" alt="AWS CloudFront CDN" data-proofer-ignore></p><h2 id="bonus-discovery-along-the-way"><span class="mr-2">Bonus Discovery along the way</span><a href="#bonus-discovery-along-the-way" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Lighthouse also indicated that served content is uncompressed resulting in high volumes of data transfer. Enabling GZip compression can reduce the data transfer volume up by 75%. Enabling GZip only required setting the <code class="language-plaintext highlighter-rouge">CacheOptimized</code> policy under <code class="language-plaintext highlighter-rouge">Behaviors</code> of the CloudFront distribution.</p><h2 id="results"><span class="mr-2">Results</span><a href="#results" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I recorded the TTFB numbers from 4PM to 9AM (the next day) for 3 consecutive weekdays to test the hypothesis. Here are the results:</p><div class="table-wrapper"><table><tbody><tr><td><strong>Function</strong><td><strong>Avg. TTFB (75pc)</strong><tr><td>No function<td>987.45ms<tr><td>Lambda@Edge<td>490.34ms<tr><td>CloudFront Functions<td>401.46ms</table></div><p>And here are the numbers for the amount of data transferred for 2 consecutive months:</p><div class="table-wrapper"><table><tbody><tr><td><strong>Dates</strong><td><strong>Data Transferred</strong><tr><td>25th Oct - 24th Nov<td>9.49 GB<tr><td>25th Nov - 25th Dec<td>2.02 GB</table></div><p>And our final content delivery setup became:</p><p><img data-src="/assets/img/2024-02-08-img-08.png" alt="SPA Content Delivery 2.0" data-proofer-ignore></p><p>Overall, the results came out to be just fantastic. The 75pc of <strong>TTFB was reduced by 50%</strong> and the <strong>Total Data Transfer was reduced by 75%</strong> on average. Target of reducing TTFB to less than 500ms was successfully achieved.</p></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/software-engineering/" class="post-tag no-text-decoration" >Software Engineering</a> <a href="/tags/aws/" class="post-tag no-text-decoration" >AWS</a> <a href="/tags/angular/" class="post-tag no-text-decoration" >Angular</a> <a href="/tags/performance/" class="post-tag no-text-decoration" >Performance</a> <a href="/tags/cloud/" class="post-tag no-text-decoration" >Cloud</a> <a href="/tags/spa/" class="post-tag no-text-decoration" >SPA</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Faster+Page+Loads+-+Reducing+the+Time+to+First+Byte+%28TTFB%29+by+50%25+-+Muhammad+Umair+Khan&url=https%3A%2F%2Fmohuk.dev%2Fposts%2Foptimizing-ttfb%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Faster+Page+Loads+-+Reducing+the+Time+to+First+Byte+%28TTFB%29+by+50%25+-+Muhammad+Umair+Khan&u=https%3A%2F%2Fmohuk.dev%2Fposts%2Foptimizing-ttfb%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fmohuk.dev%2Fposts%2Foptimizing-ttfb%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/optimizing-ttfb/">Faster Page Loads - Reducing the Time to First Byte (TTFB) by 50%</a><li><a href="/posts/adieu-airlift/">Adieu Airlift</a><li><a href="/posts/engineering-management-in-software/">Engineering Management in Software</a><li><a href="/posts/simple-questions-that-helped-us-deliver-2-weeks-before-deadline/">Simple questions that helped us deliver 2 weeks before deadline</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/angularjs/">AngularJS</a> <a class="post-tag" href="/tags/software-engineering-management/">Software Engineering Management</a> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/software-engineering/">Software Engineering</a> <a class="post-tag" href="/tags/angular/">Angular</a> <a class="post-tag" href="/tags/cloud/">Cloud</a> <a class="post-tag" href="/tags/nodejs/">NodeJS</a> <a class="post-tag" href="/tags/performance/">Performance</a> <a class="post-tag" href="/tags/spa/">SPA</a> <a class="post-tag" href="/tags/thoughts/">Thoughts</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/building-a-notification-system-over-a-webapp/"><div class="card-body"> <em class="small" data-ts="1671926357" data-df="ll" > Dec 25, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Building a notification system over a webapp</h3><div class="text-muted small"><p> Up until the world exploded into apps, communication between the schools and children’s parents was done through the children’s diary. Fast forward today, diaries are no longer in fashion. Every sc...</p></div></div></a></div><div class="card"> <a href="/posts/adieu-airlift/"><div class="card-body"> <em class="small" data-ts="1658879957" data-df="ll" > Jul 27, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Adieu Airlift</h3><div class="text-muted small"><p> The dreaded second week of July, 2022. Airlift decides to close all of its operations in Pakistan. It was good while it lasted. I have been in the tech space of Pakistan since 2012. A tech space d...</p></div></div></a></div><div class="card"> <a href="/posts/engineering-management-in-software/"><div class="card-body"> <em class="small" data-ts="1652399957" data-df="ll" > May 13, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Engineering Management in Software</h3><div class="text-muted small"><p> On May 30th, 2021, after spending almost 8 years in an individual contributor role, I stepped into the uncharted waters known as “Engineering Management”. Having spent almost a year as an EM, I’ve ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/building-a-notification-system-over-a-webapp/" class="btn btn-outline-primary" prompt="Older"><p>Building a notification system over a webapp</p></a><div class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></div></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/mohukh">Muhammad Umair Khan</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/angularjs/">AngularJS</a> <a class="post-tag" href="/tags/software-engineering-management/">Software Engineering Management</a> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/software-engineering/">Software Engineering</a> <a class="post-tag" href="/tags/angular/">Angular</a> <a class="post-tag" href="/tags/cloud/">Cloud</a> <a class="post-tag" href="/tags/nodejs/">NodeJS</a> <a class="post-tag" href="/tags/performance/">Performance</a> <a class="post-tag" href="/tags/spa/">SPA</a> <a class="post-tag" href="/tags/thoughts/">Thoughts</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-763M8X9DVK"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-763M8X9DVK'); }); </script>
